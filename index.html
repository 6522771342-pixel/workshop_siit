<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartLife Assistant</title>
    <script>
        tailwind = {
            config: {
                darkMode: 'class',
                theme: {
                    extend: {
                        fontFamily: {
                            sans: ['Inter', 'sans-serif'],
                        },
                        animation: {
                            'fade-in': 'fadeIn 0.3s ease-in-out',
                            'slide-up': 'slideUp 0.3s ease-out',
                        },
                        keyframes: {
                            fadeIn: {
                                '0%': { opacity: '0' },
                                '100%': { opacity: '1' },
                            },
                            slideUp: {
                                '0%': { transform: 'translateY(10px)', opacity: '0' },
                                '100%': { transform: 'translateY(0)', opacity: '1' },
                            }
                        }
                    },
                },
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        .active-nav { 
            @apply bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold shadow-lg shadow-indigo-200 dark:shadow-indigo-900/30; 
        }
        
        .pulse-alert { 
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: .8; transform: scale(1.02); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .dark ::-webkit-scrollbar-track { background: #0f172a; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .dark .glass {
            background: rgba(15, 23, 42, 0.7);
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .dark .gradient-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        }
        
        /* Hover effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .dark .hover-lift:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-indigo-50/30 to-purple-50/20 text-slate-900 min-h-screen flex transition-colors duration-300 dark:from-slate-950 dark:via-indigo-950/30 dark:to-purple-950/20 dark:text-slate-100">
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none"></div>

    <!-- Sidebar -->
    <aside class="w-72 bg-white/80 backdrop-blur-xl border-r border-slate-200/50 fixed h-full hidden md:flex flex-col z-20 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
        <div class="p-8">
            <h1 class="text-3xl font-extrabold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center gap-3 dark:from-indigo-400 dark:to-purple-400">
                <div class="p-2 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-xl shadow-lg">
                    <i data-lucide="zap" class="text-white" size="24"></i>
                </div>
                SmartLife
            </h1>
            <p class="text-xs text-slate-500 mt-2 dark:text-slate-400">Your intelligent life companion</p>
        </div>
        
        <nav class="mt-4 px-6 space-y-3 flex-1">
            <button onclick="switchView('dashboard')" id="nav-dashboard" class="w-full flex items-center gap-3 px-5 py-4 rounded-2xl transition-all active-nav">
                <i data-lucide="layout-dashboard" size="20"></i> 
                <span class="font-medium">Dashboard</span>
            </button>
            <button onclick="switchView('schedule')" id="nav-schedule" class="w-full flex items-center gap-3 px-5 py-4 rounded-2xl text-slate-600 hover:bg-slate-100/80 transition-all dark:text-slate-400 dark:hover:bg-slate-800/50">
                <i data-lucide="calendar" size="20"></i> 
                <span class="font-medium">Schedule</span>
            </button>
            <button onclick="switchView('tasks')" id="nav-tasks" class="w-full flex items-center gap-3 px-5 py-4 rounded-2xl text-slate-600 hover:bg-slate-100/80 transition-all dark:text-slate-400 dark:hover:bg-slate-800/50">
                <i data-lucide="check-square" size="20"></i> 
                <span class="font-medium">Tasks</span>
            </button>
            <button onclick="switchView('mood')" id="nav-mood" class="w-full flex items-center gap-3 px-5 py-4 rounded-2xl text-slate-600 hover:bg-slate-100/80 transition-all dark:text-slate-400 dark:hover:bg-slate-800/50">
                <i data-lucide="smile" size="20"></i> 
                <span class="font-medium">Mood Tracker</span>
            </button>
            <button onclick="switchView('settings')" id="nav-settings" class="w-full flex items-center gap-3 px-5 py-4 rounded-2xl text-slate-600 hover:bg-slate-100/80 transition-all dark:text-slate-400 dark:hover:bg-slate-800/50">
                <i data-lucide="settings" size="20"></i> 
                <span class="font-medium">Settings</span>
            </button>
        </nav>
        
        <div class="p-6 border-t border-slate-200/50 dark:border-slate-800/50">
            <button onclick="window.toggleDarkMode()" class="w-full flex items-center justify-between px-5 py-4 rounded-2xl bg-slate-100/80 hover:bg-slate-200/80 transition-all dark:bg-slate-800/50 dark:hover:bg-slate-700/50">
                <div class="flex items-center gap-3 pointer-events-none">
                    <i id="theme-icon" data-lucide="moon" size="20"></i>
                    <span id="theme-text" class="font-medium">Dark Mode</span>
                </div>
                <div class="w-12 h-6 bg-slate-300 rounded-full relative transition-colors dark:bg-indigo-600 pointer-events-none shadow-inner">
                    <div id="theme-toggle-dot" class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow-md"></div>
                </div>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 md:ml-72 p-6 md:p-10">
        <div id="view-content" class="max-w-6xl mx-auto animate-fade-in">
            <!-- Content will be injected here -->
        </div>
    </main>

    <script>
        // State Management with view persistence
        let state = JSON.parse(localStorage.getItem('smartlife-vanilla-data')) || {
            tasks: [],
            moods: [],
            schedule: [],
            settings: { darkMode: false },
            currentView: 'dashboard' // Store current view
        };

        // UI States
        let taskFilter = 'all';
        let currentView = state.currentView || 'dashboard';

        function saveState() {
            state.currentView = currentView; // Save current view
            localStorage.setItem('smartlife-vanilla-data', JSON.stringify(state));
            render();
        }

        // Dark Mode Logic - Fixed to work properly
        function applyTheme(isDark) {
            const html = document.documentElement;
            const dot = document.getElementById('theme-toggle-dot');
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');

            if (isDark) {
                html.classList.add('dark');
                if (dot) dot.style.transform = 'translateX(24px)';
                if (icon) icon.setAttribute('data-lucide', 'sun');
                if (text) text.innerText = 'Light Mode';
            } else {
                html.classList.remove('dark');
                if (dot) dot.style.transform = 'translateX(0px)';
                if (icon) icon.setAttribute('data-lucide', 'moon');
                if (text) text.innerText = 'Dark Mode';
            }
            
            try {
                if (window.lucide) window.lucide.createIcons();
            } catch (e) {}
        }

        window.toggleDarkMode = function() {
            state.settings.darkMode = !state.settings.darkMode;
            applyTheme(state.settings.darkMode);
            localStorage.setItem('smartlife-vanilla-data', JSON.stringify(state));
            showToast(state.settings.darkMode ? 'Dark mode enabled üåô' : 'Light mode enabled ‚òÄÔ∏è', 'info');
        };

        // View Switching
        window.switchView = function(view) {
            currentView = view;
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active-nav', 'shadow-lg', 'shadow-indigo-200', 'dark:shadow-indigo-900/30');
                btn.classList.add('text-slate-600', 'dark:text-slate-400');
            });
            
            const activeBtn = document.getElementById(`nav-${view}`);
            if (activeBtn) {
                activeBtn.classList.add('active-nav');
                activeBtn.classList.remove('text-slate-600', 'dark:text-slate-400');
            }
            
            saveState(); // Save view state
        };

        // Renderers
        function render() {
            const container = document.getElementById('view-content');
            container.style.animation = 'none';
            setTimeout(() => {
                container.style.animation = '';
                if (currentView === 'dashboard') renderDashboard(container);
                else if (currentView === 'schedule') renderSchedule(container);
                else if (currentView === 'tasks') renderTasks(container);
                else if (currentView === 'mood') renderMood(container);
                else if (currentView === 'settings') renderSettings(container);
                
                lucide.createIcons();
            }, 10);
        }

        function generateInsights() {
            const insights = [];
            
            // Mood Insight
            const lastMoods = state.moods.slice(-3);
            if (lastMoods.length >= 2) {
                const recentSad = lastMoods.every(m => m.mood === 'üò¢' || m.mood === 'üòï');
                if (recentSad) {
                    insights.push({
                        title: "Mindfulness Check",
                        text: "You've been feeling a bit down lately. Why not take a short walk or call a friend?",
                        type: "mood",
                        icon: "heart"
                    });
                }
            }

            // Schedule Density Insight
            if (state.schedule.length > 3) {
                insights.push({
                    title: "Busy Day Ahead",
                    text: "Your schedule is looking packed. Make sure to stay hydrated and take eye breaks!",
                    type: "schedule",
                    icon: "zap"
                });
            }

            // Tasks Insight
            const pendingTasks = state.tasks.filter(t => !t.completed).length;
            if (pendingTasks > 5) {
                insights.push({
                    title: "Task Overload",
                    text: `You have ${pendingTasks} pending tasks. Try breaking them into smaller steps.`,
                    type: "task",
                    icon: "alert-circle"
                });
            }

            if (insights.length === 0) {
                insights.push({
                    title: "You're doing great!",
                    text: "Your life balance looks stable. Keep up the amazing work!",
                    type: "positive",
                    icon: "sparkles"
                });
            }

            return insights;
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const icons = { success: 'check-circle', info: 'info', warning: 'alert-circle' };
            const colors = { 
                success: 'bg-gradient-to-r from-green-500 to-emerald-500', 
                info: 'bg-gradient-to-r from-blue-500 to-cyan-500', 
                warning: 'bg-gradient-to-r from-amber-500 to-orange-500' 
            };
            
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 pointer-events-auto transform transition-all duration-300`;
            toast.innerHTML = `<i data-lucide="${icons[type]}" size="20"></i> <span class="font-medium">${message}</span>`;
            
            container.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function renderDashboard(container) {
            const today = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const todayStr = new Date().toISOString().split('T')[0];
            const todayMood = state.moods.find(m => m.date === todayStr)?.mood || '‚ùì';
            const completedTasks = state.tasks.filter(t => t.completed).length;
            const insights = generateInsights();

            container.innerHTML = `
                <div class="space-y-8 animate-slide-up">
                    <header class="flex justify-between items-start">
                        <div>
                            <h2 class="text-4xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-white dark:to-slate-300">Welcome Back!</h2>
                            <p class="text-slate-500 mt-2 text-lg dark:text-slate-400">${today}</p>
                        </div>
                    </header>
                    
                    <!-- Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white/80 backdrop-blur-sm p-7 rounded-3xl border border-slate-200/50 shadow-xl hover-lift flex items-center gap-5 dark:bg-slate-900/80 dark:border-slate-800/50">
                            <div class="p-4 bg-gradient-to-br from-yellow-400 to-orange-400 rounded-2xl text-white shadow-lg">
                                <i data-lucide="sun" size="28"></i>
                            </div>
                            <div>
                                <p class="text-sm font-semibold text-slate-500 dark:text-slate-400">Mood Today</p>
                                <p class="text-3xl font-bold dark:text-white">${todayMood}</p>
                            </div>
                        </div>
                        <div class="bg-white/80 backdrop-blur-sm p-7 rounded-3xl border border-slate-200/50 shadow-xl hover-lift flex items-center gap-5 dark:bg-slate-900/80 dark:border-slate-800/50">
                            <div class="p-4 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl text-white shadow-lg">
                                <i data-lucide="check-circle" size="28"></i>
                            </div>
                            <div>
                                <p class="text-sm font-semibold text-slate-500 dark:text-slate-400">Tasks Done</p>
                                <p class="text-3xl font-bold dark:text-white">${completedTasks}/${state.tasks.length}</p>
                            </div>
                        </div>
                        <div class="bg-white/80 backdrop-blur-sm p-7 rounded-3xl border border-slate-200/50 shadow-xl hover-lift flex items-center gap-5 dark:bg-slate-900/80 dark:border-slate-800/50">
                            <div class="p-4 bg-gradient-to-br from-blue-400 to-indigo-400 rounded-2xl text-white shadow-lg">
                                <i data-lucide="calendar" size="28"></i>
                            </div>
                            <div>
                                <p class="text-sm font-semibold text-slate-500 dark:text-slate-400">Events</p>
                                <p class="text-3xl font-bold dark:text-white">${state.schedule.length}</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Main Banner -->
                            <div class="gradient-bg p-10 rounded-3xl text-white shadow-2xl flex flex-col md:flex-row items-center justify-between gap-6 hover-lift">
                                <div>
                                    <h3 class="text-3xl font-extrabold mb-3">Ready for a productive day?</h3>
                                    <p class="text-indigo-100 text-lg">You have ${state.tasks.filter(t=>!t.completed).length} tasks pending and ${state.schedule.length} upcoming events.</p>
                                </div>
                                <button onclick="switchView('tasks')" class="bg-white text-indigo-600 px-8 py-4 rounded-2xl font-bold hover:bg-indigo-50 transition-all shadow-lg hover:shadow-xl transform hover:scale-105 whitespace-nowrap">Manage Tasks</button>
                            </div>

                            <!-- Dashboard Schedule List -->
                            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
                                <h3 class="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 dark:text-slate-100">
                                    <div class="p-2 bg-indigo-100 rounded-xl dark:bg-indigo-900/40">
                                        <i data-lucide="clock" class="text-indigo-600 dark:text-indigo-400" size="20"></i>
                                    </div>
                                    Active Schedule
                                </h3>
                                <div class="space-y-4">
                                    ${[...state.schedule].sort((a,b)=>a.time.localeCompare(b.time)).map(item => {
                                        const now = new Date();
                                        const currentMinutes = now.getHours() * 60 + now.getMinutes();
                                        const [startH, startM] = item.time.split(':').map(Number);
                                        const startMinutes = startH * 60 + startM;
                                        const endMinutes = startMinutes + parseInt(item.duration || 60);
                                        const isActive = currentMinutes >= startMinutes && currentMinutes < endMinutes;

                                        return `
                                            <div class="flex gap-4 items-center p-4 rounded-2xl transition-all hover-lift ${isActive ? 'bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 dark:from-indigo-900/20 dark:to-purple-900/20 dark:border-indigo-800' : 'bg-slate-50 dark:bg-slate-800/50'}">
                                                <span class="font-mono font-bold ${isActive ? 'text-indigo-600 dark:text-indigo-400' : 'text-slate-400'} w-14 text-base">${item.time}</span>
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-slate-800 dark:text-slate-200">${item.title}</h4>
                                                    <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider mt-1">${item.type} ‚Ä¢ ${item.duration}m</p>
                                                </div>
                                                ${isActive ? '<span class="flex h-3 w-3 rounded-full bg-indigo-500 animate-pulse shadow-lg shadow-indigo-300"></span>' : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                    ${state.schedule.length === 0 ? '<p class="text-slate-400 text-center py-8 text-lg">No events planned for today.</p>' : ''}
                                </div>
                            </div>

                            <!-- Smart Insights -->
                            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
                                <h3 class="font-bold text-xl text-slate-800 mb-6 flex items-center gap-3 dark:text-slate-100">
                                    <div class="p-2 bg-purple-100 rounded-xl dark:bg-purple-900/40">
                                        <i data-lucide="sparkles" class="text-purple-600 dark:text-purple-400" size="20"></i>
                                    </div>
                                    Smart Insights
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                    ${insights.map(insight => `
                                        <div class="p-5 rounded-2xl bg-slate-50/80 border border-slate-200/50 flex gap-4 hover-lift dark:bg-slate-800/50 dark:border-slate-700/50 ${insight.type !== 'positive' ? 'pulse-alert border-amber-200 dark:border-amber-900/40' : ''}">
                                            <div class="p-3 rounded-xl h-fit ${insight.type === 'positive' ? 'bg-gradient-to-br from-green-400 to-emerald-400 text-white shadow-lg' : 'bg-gradient-to-br from-amber-400 to-orange-400 text-white shadow-lg'}">
                                                <i data-lucide="${insight.icon}" size="22"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">${insight.title}</h4>
                                                <p class="text-sm text-slate-600 dark:text-slate-400">${insight.text}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Side Content -->
                        <div class="space-y-6">
                            <div class="bg-white/80 backdrop-blur-sm p-7 rounded-3xl border border-slate-200/50 shadow-xl hover-lift dark:bg-slate-900/80 dark:border-slate-800/50">
                                <h3 class="font-bold text-lg text-slate-800 mb-6 text-center dark:text-slate-100">Time Distribution</h3>
                                <div class="h-56">
                                    <canvas id="timeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            setTimeout(initDashboardChart, 0);
        }

        function initDashboardChart() {
            const ctx = document.getElementById('timeChart');
            if (!ctx) return;

            const counts = {};
            state.schedule.forEach(s => {
                const type = s.type || 'other';
                const duration = parseInt(s.duration || 60);
                counts[type] = (counts[type] || 0) + duration;
            });

            if (Object.keys(counts).length === 0) {
                ctx.parentElement.innerHTML = '<p class="text-slate-400 text-center py-16 dark:text-slate-500">Add schedule items to see distribution</p>';
                return;
            }

            const isDark = document.documentElement.classList.contains('dark');

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(counts).map(k => k.charAt(0).toUpperCase() + k.slice(1)),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: [
                            '#6366f1', '#a855f7', '#22c55e', '#f97316', '#ec4899', '#64748b'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                usePointStyle: true, 
                                padding: 12, 
                                boxWidth: 8, 
                                color: isDark ? '#94a3b8' : '#64748b',
                                font: { size: 11, weight: '600' } 
                            } 
                        } 
                    },
                    cutout: '65%'
                }
            });
        }

        function renderTasks(container) {
            let filteredTasks = state.tasks;
            if (taskFilter === 'active') filteredTasks = state.tasks.filter(t => !t.completed);
            else if (taskFilter === 'completed') filteredTasks = state.tasks.filter(t => t.completed);

            const priorityColors = {
                high: 'text-red-600 bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-900/40 dark:text-red-400',
                medium: 'text-amber-600 bg-amber-50 border-amber-200 dark:bg-amber-900/20 dark:border-amber-900/40 dark:text-amber-400',
                low: 'text-emerald-600 bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-900/40 dark:text-emerald-400'
            };

            container.innerHTML = `
                <div class="space-y-6 max-w-4xl animate-slide-up">
                    <div class="flex justify-between items-center">
                        <h2 class="text-4xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-white dark:to-slate-300">Tasks</h2>
                        <div class="flex gap-2">
                            <button onclick="setTaskFilter('all')" class="px-4 py-2 text-sm font-semibold rounded-xl transition-all ${taskFilter === 'all' ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg' : 'bg-white border-2 border-slate-200 text-slate-600 hover:border-indigo-200 dark:bg-slate-900 dark:border-slate-800 dark:text-slate-400'}">All</button>
                            <button onclick="setTaskFilter('active')" class="px-4 py-2 text-sm font-semibold rounded-xl transition-all ${taskFilter === 'active' ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg' : 'bg-white border-2 border-slate-200 text-slate-600 hover:border-indigo-200 dark:bg-slate-900 dark:border-slate-800 dark:text-slate-400'}">Active</button>
                            <button onclick="setTaskFilter('completed')" class="px-4 py-2 text-sm font-semibold rounded-xl transition-all ${taskFilter === 'completed' ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg' : 'bg-white border-2 border-slate-200 text-slate-600 hover:border-indigo-200 dark:bg-slate-900 dark:border-slate-800 dark:text-slate-400'}">Done</button>
                        </div>
                    </div>

                    <div class="bg-white/80 backdrop-blur-sm p-7 rounded-3xl border border-slate-200/50 shadow-xl space-y-4 dark:bg-slate-900/80 dark:border-slate-800/50">
                        <div class="flex flex-col md:flex-row gap-3">
                            <input id="task-input" type="text" placeholder="What needs to be done?" class="flex-1 p-4 rounded-2xl border-2 border-slate-200 bg-white/50 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all dark:border-slate-700 dark:bg-slate-800/50 dark:text-white dark:placeholder-slate-500">
                            <div class="flex gap-2">
                                <select id="task-priority" class="p-4 rounded-2xl border-2 border-slate-200 text-sm font-semibold bg-white outline-none focus:ring-2 focus:ring-indigo-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300">
                                    <option value="low">Low Priority</option>
                                    <option value="medium" selected>Med Priority</option>
                                    <option value="high">High Priority</option>
                                </select>
                                <select id="task-category" class="p-4 rounded-2xl border-2 border-slate-200 text-sm font-semibold bg-white outline-none focus:ring-2 focus:ring-indigo-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300">
                                    <option value="work">Work</option>
                                    <option value="personal">Personal</option>
                                    <option value="health">Health</option>
                                    <option value="other">Other</option>
                                </select>
                                <button onclick="addTask()" class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white p-4 rounded-2xl hover:shadow-lg transition-all transform hover:scale-105">
                                    <i data-lucide="plus" size="20"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        ${filteredTasks.map((t) => `
                            <div class="bg-white/80 backdrop-blur-sm p-5 rounded-2xl border border-slate-200/50 flex items-center gap-4 group transition-all hover:border-indigo-300 hover:shadow-lg hover-lift dark:bg-slate-900/80 dark:border-slate-800/50 dark:hover:border-indigo-800/60">
                                <button onclick="toggleTask('${t.id}')" class="transition-all transform hover:scale-110 ${t.completed ? 'text-green-500' : 'text-slate-300 hover:text-indigo-500 dark:text-slate-700 dark:hover:text-indigo-400'}">
                                    <i data-lucide="${t.completed ? 'check-circle' : 'circle'}" size="26"></i>
                                </button>
                                <div class="flex-1">
                                    <span class="block text-base ${t.completed ? 'line-through text-slate-400 dark:text-slate-600' : 'text-slate-800 font-semibold dark:text-slate-200'}">${t.text}</span>
                                    <div class="flex gap-2 mt-2">
                                        <span class="text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-lg border ${priorityColors[t.priority || 'medium']}">${t.priority || 'medium'}</span>
                                        <span class="text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-lg bg-slate-100 text-slate-600 border border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700">${t.category || 'other'}</span>
                                    </div>
                                </div>
                                <button onclick="deleteTask('${t.id}')" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all transform hover:scale-110 dark:text-slate-700 dark:hover:text-red-400">
                                    <i data-lucide="trash-2" size="20"></i>
                                </button>
                            </div>
                        `).join('')}
                        
                        ${filteredTasks.length === 0 ? `
                            <div class="text-center py-24 bg-slate-50/80 rounded-3xl border-2 border-dashed border-slate-200 dark:bg-slate-900/50 dark:border-slate-800">
                                <p class="text-slate-400 text-lg dark:text-slate-600">No tasks found. Time to relax? üå¥</p>
                            </div>
                        ` : ''}
                    </div>

                    ${state.tasks.some(t => t.completed) ? `
                        <div class="flex justify-center pt-6">
                            <button onclick="clearCompleted()" class="text-sm font-semibold text-slate-400 hover:text-red-500 flex items-center gap-2 transition-all px-4 py-2 rounded-xl hover:bg-red-50 dark:text-slate-600 dark:hover:text-red-400 dark:hover:bg-red-900/20">
                                <i data-lucide="eraser" size="18"></i> Clear Completed Tasks
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderSchedule(container) {
            const priorityColors = {
                work: 'border-blue-400 bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400',
                break: 'border-green-400 bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400',
                meeting: 'border-purple-400 bg-purple-50 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400',
                meal: 'border-orange-400 bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400',
                personal: 'border-pink-400 bg-pink-50 text-pink-700 dark:bg-pink-900/20 dark:text-pink-400',
                sleep: 'border-indigo-400 bg-indigo-50 text-indigo-700 dark:bg-indigo-900/20 dark:text-indigo-400'
            };

            const sortedSchedule = [...state.schedule].sort((a, b) => a.time.localeCompare(b.time));
            
            const now = new Date();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

            container.innerHTML = `
                <div class="space-y-8 max-w-5xl mx-auto animate-slide-up">
                    <div class="flex justify-between items-center">
                        <h2 class="text-4xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-white dark:to-slate-300">Daily Schedule</h2>
                        <span class="px-5 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl text-sm font-bold shadow-lg">
                            ${state.schedule.length} Activities
                        </span>
                    </div>

                    <!-- Add Event Form -->
                    <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
                        <h3 class="font-bold text-lg mb-6 flex items-center gap-3 dark:text-slate-100">
                            <div class="p-2 bg-indigo-100 rounded-xl dark:bg-indigo-900/40">
                                <i data-lucide="plus-circle" class="text-indigo-600 dark:text-indigo-400" size="20"></i>
                            </div>
                            New Activity
                        </h3>
                        <form onsubmit="event.preventDefault(); addSchedule();" class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Title</label>
                                    <input id="sched-title" type="text" placeholder="e.g. Deep Work" class="w-full p-4 rounded-2xl border-2 border-slate-200 bg-white/50 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all dark:border-slate-700 dark:bg-slate-800/50 dark:text-white">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Start Time</label>
                                    <input id="sched-time" type="time" value="${currentTime}" class="w-full p-4 rounded-2xl border-2 border-slate-200 bg-white/50 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all dark:border-slate-700 dark:bg-slate-800/50 dark:text-white">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Duration</label>
                                    <select id="sched-duration" class="w-full p-4 rounded-2xl border-2 border-slate-200 bg-white font-semibold outline-none focus:ring-2 focus:ring-indigo-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300">
                                        <option value="15">15 min</option>
                                        <option value="30">30 min</option>
                                        <option value="45">45 min</option>
                                        <option value="60" selected>1 Hour</option>
                                        <option value="90">1.5 Hours</option>
                                        <option value="120">2 Hours</option>
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Type</label>
                                    <select id="sched-type" class="w-full p-4 rounded-2xl border-2 border-slate-200 bg-white font-semibold outline-none focus:ring-2 focus:ring-indigo-500 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300">
                                        <option value="work">üíº Work</option>
                                        <option value="meeting">üë• Meeting</option>
                                        <option value="break">‚òï Break</option>
                                        <option value="meal">üçΩÔ∏è Meal</option>
                                        <option value="personal">üè† Personal</option>
                                        <option value="sleep">üò¥ Sleep</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white p-5 rounded-2xl font-bold hover:shadow-2xl transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-xl">
                                Add to Timeline
                            </button>
                        </form>
                    </div>

                    <!-- Timeline -->
                    <div class="relative pl-10 border-l-4 border-slate-200 dark:border-slate-800 ml-6 space-y-8">
                        ${sortedSchedule.length === 0 ? `
                            <div class="bg-slate-50/80 p-16 rounded-3xl border-2 border-dashed border-slate-200 text-center dark:bg-slate-900/50 dark:border-slate-800">
                                <p class="text-slate-400 text-lg">Your timeline is empty. Plan your day above!</p>
                            </div>
                        ` : sortedSchedule.map((s) => `
                            <div class="relative group">
                                <!-- Dot -->
                                <div class="absolute -left-[50px] top-7 w-7 h-7 rounded-full bg-white border-4 border-indigo-500 dark:bg-slate-950 z-10 shadow-lg"></div>
                                
                                <div class="bg-white/80 backdrop-blur-sm p-6 rounded-3xl border border-slate-200/50 shadow-xl transition-all group-hover:border-indigo-300 group-hover:shadow-2xl hover-lift dark:bg-slate-900/80 dark:border-slate-800/50 dark:group-hover:border-indigo-800">
                                    <div class="flex justify-between items-start gap-4">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-2">
                                                <span class="font-mono font-bold text-lg text-indigo-600 dark:text-indigo-400">${s.time}</span>
                                                <span class="text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-lg bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400">${s.duration} min</span>
                                                <span class="text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-lg border-2 ${priorityColors[s.type || 'work']}">${s.type || 'work'}</span>
                                            </div>
                                            <h4 class="text-xl font-bold text-slate-800 dark:text-slate-100">${s.title}</h4>
                                        </div>
                                        <button onclick="deleteSchedule('${s.id}')" class="p-3 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all opacity-0 group-hover:opacity-100 transform hover:scale-110 dark:hover:bg-red-900/20">
                                            <i data-lucide="trash-2" size="20"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderMood(container) {
            const emojis = ['üò¢', 'üòï', 'üòê', 'üôÇ', 'ü§©'];
            container.innerHTML = `
                <div class="space-y-10 text-center py-16 animate-slide-up">
                    <h2 class="text-4xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-white dark:to-slate-300">How are you feeling today?</h2>
                    <div class="flex justify-center gap-5">
                        ${emojis.map(e => `
                            <button onclick="setMood('${e}')" class="text-6xl p-6 hover:bg-indigo-50 rounded-3xl transition-all hover:scale-125 active:scale-95 border-2 border-transparent hover:border-indigo-200 hover:shadow-xl transform dark:hover:bg-indigo-900/20 dark:hover:border-indigo-900/40">
                                ${e}
                            </button>
                        `).join('')}
                    </div>
                    <div class="max-w-5xl mx-auto bg-white/80 backdrop-blur-sm p-10 rounded-3xl border border-slate-200/50 mt-12 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
                        <h3 class="font-bold text-xl text-slate-800 mb-8 flex items-center gap-3 justify-center dark:text-slate-100">
                            <div class="p-2 bg-indigo-100 rounded-xl dark:bg-indigo-900/40">
                                <i data-lucide="trending-up" class="text-indigo-600 dark:text-indigo-400" size="22"></i>
                            </div>
                            Mood Trend
                        </h3>
                        <div class="h-72">
                            <canvas id="moodChart"></canvas>
                        </div>
                    </div>
                    <div class="max-w-lg mx-auto bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 mt-10 shadow-xl dark:bg-slate-900/80 dark:border-slate-800/50">
                        <h3 class="font-bold text-lg mb-6 dark:text-slate-100">Mood History</h3>
                        <div class="space-y-3">
                            ${state.moods.slice(-5).reverse().map(m => `
                                <div class="flex justify-between p-4 rounded-2xl bg-slate-50 border border-slate-100 dark:bg-slate-800/50 dark:border-slate-700/50">
                                    <span class="text-slate-600 font-semibold dark:text-slate-400">${m.date}</span>
                                    <span class="text-2xl">${m.mood}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            setTimeout(initMoodChart, 0);
        }

        function initMoodChart() {
            const ctx = document.getElementById('moodChart');
            if (!ctx) return;

            const moodMap = { 'üò¢': 1, 'üòï': 2, 'üòê': 3, 'üôÇ': 4, 'ü§©': 5 };
            const last7Days = state.moods.slice(-7);
            
            if (last7Days.length < 2) {
                ctx.parentElement.innerHTML = '<p class="text-slate-400 text-center py-24 text-lg dark:text-slate-500">Log your mood for a few days to see trends</p>';
                return;
            }

            const isDark = document.documentElement.classList.contains('dark');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(m => m.date.split('-').slice(1).join('/')),
                    datasets: [{
                        label: 'Happiness Level',
                        data: last7Days.map(m => moodMap[m.mood]),
                        borderColor: '#6366f1',
                        backgroundColor: isDark ? 'rgba(99, 102, 241, 0.1)' : 'rgba(99, 102, 241, 0.15)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#6366f1',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            min: 1, 
                            max: 5, 
                            grid: { color: isDark ? '#1e293b' : '#f1f5f9' },
                            ticks: { 
                                stepSize: 1, 
                                color: isDark ? '#94a3b8' : '#64748b',
                                font: { size: 14, weight: '600' },
                                callback: (v) => ['','üò¢', 'üòï', 'üòê', 'üôÇ', 'ü§©'][v] 
                            } 
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { 
                                color: isDark ? '#94a3b8' : '#64748b',
                                font: { size: 12, weight: '600' }
                            }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderSettings(container) {
            container.innerHTML = `
                <div class="space-y-8 max-w-4xl animate-slide-up">
                    <h2 class="text-4xl font-extrabold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent dark:from-white dark:to-slate-300">Settings</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Data Management -->
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 shadow-xl hover-lift dark:bg-slate-900/80 dark:border-slate-800/50">
                            <h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-3 dark:text-slate-100">
                                <div class="p-2 bg-indigo-100 rounded-xl dark:bg-indigo-900/40">
                                    <i data-lucide="database" class="text-indigo-600 dark:text-indigo-400" size="20"></i>
                                </div>
                                Data Management
                            </h3>
                            <p class="text-sm text-slate-600 mb-6 dark:text-slate-400">Backup your data to a JSON file or restore it from a previous backup.</p>
                            
                            <div class="space-y-3">
                                <button onclick="exportData()" class="w-full flex items-center justify-center gap-3 px-5 py-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl font-bold hover:shadow-xl transition-all transform hover:scale-105">
                                    <i data-lucide="download" size="20"></i> Export Data (.json)
                                </button>
                                <label class="w-full flex items-center justify-center gap-3 px-5 py-4 bg-white border-2 border-dashed border-slate-300 text-slate-700 rounded-2xl font-bold hover:bg-slate-50 hover:border-indigo-300 cursor-pointer transition-all transform hover:scale-105 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-700">
                                    <i data-lucide="upload" size="20"></i> Import Data
                                    <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                                </label>
                            </div>
                        </div>

                        <!-- Reset App -->
                        <div class="bg-white/80 backdrop-blur-sm p-8 rounded-3xl border border-slate-200/50 shadow-xl hover-lift dark:bg-slate-900/80 dark:border-slate-800/50">
                            <h3 class="font-bold text-lg text-slate-800 mb-4 flex items-center gap-3 dark:text-slate-100">
                                <div class="p-2 bg-red-100 rounded-xl dark:bg-red-900/40">
                                    <i data-lucide="refresh-ccw" class="text-red-600 dark:text-red-400" size="20"></i>
                                </div>
                                Reset System
                            </h3>
                            <p class="text-sm text-slate-600 mb-6 dark:text-slate-400">Permanently delete all your tasks, schedule, and mood history. This action cannot be undone.</p>
                            
                            <button onclick="resetApp()" class="w-full flex items-center justify-center gap-3 px-5 py-4 bg-red-50 text-red-600 border-2 border-red-200 rounded-2xl font-bold hover:bg-red-100 hover:border-red-300 transition-all transform hover:scale-105 dark:bg-red-900/20 dark:border-red-900/40 dark:text-red-400">
                                <i data-lucide="trash-2" size="20"></i> Reset All Data
                            </button>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-8 rounded-3xl border border-indigo-200/50 shadow-lg dark:from-indigo-900/20 dark:to-purple-900/20 dark:border-indigo-900/40">
                        <div class="flex gap-5">
                            <div class="p-4 bg-gradient-to-br from-indigo-400 to-purple-400 rounded-2xl h-fit shadow-lg">
                                <i data-lucide="info" class="text-white" size="24"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-indigo-900 dark:text-indigo-300">About SmartLife</h4>
                                <p class="text-sm text-indigo-700 mt-2 dark:text-indigo-400/80">Version 2.0.0 - Enhanced UI Update. Your data is stored locally in your browser and never leaves your device. Enjoy improved dark mode, persistent navigation, and beautiful new design! üé®</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "smartlife-backup-" + new Date().toISOString().split('T')[0] + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showToast('Data exported successfully! üìÇ');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedState = JSON.parse(e.target.result);
                    if (confirm('Importing this file will overwrite your current data. Continue?')) {
                        state = importedState;
                        currentView = state.currentView || 'dashboard';
                        saveState();
                        applyTheme(state.settings.darkMode);
                        showToast('Data restored successfully! üöÄ');
                    }
                } catch (err) {
                    showToast('Invalid backup file', 'warning');
                }
            };
            reader.readAsText(file);
        }

        function resetApp() {
            if (confirm('Are you absolutely sure you want to delete ALL data? This cannot be undone.')) {
                state = {
                    tasks: [],
                    moods: [],
                    schedule: [],
                    settings: { darkMode: state.settings.darkMode },
                    currentView: 'dashboard'
                };
                currentView = 'dashboard';
                saveState();
                showToast('System reset completed', 'info');
            }
        }

        // Actions
        window.setTaskFilter = (filter) => {
            taskFilter = filter;
            render();
        };

        window.addTask = () => {
            const input = document.getElementById('task-input');
            const priority = document.getElementById('task-priority').value;
            const category = document.getElementById('task-category').value;
            
            if (!input.value.trim()) return;
            
            const newTask = {
                id: Date.now().toString(),
                text: input.value,
                completed: false,
                priority: priority,
                category: category,
                createdAt: new Date().toISOString()
            };

            state.tasks.push(newTask);
            input.value = '';
            saveState();
            showToast('Task added successfully! ‚ú®');
        };

        window.toggleTask = (id) => {
            const task = state.tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveState();
                if (task.completed) showToast('Task completed! üéâ');
            }
        };

        window.deleteTask = (id) => {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveState();
            showToast('Task deleted', 'info');
        };

        window.clearCompleted = () => {
            const initialCount = state.tasks.length;
            state.tasks = state.tasks.filter(t => !t.completed);
            const deletedCount = initialCount - state.tasks.length;
            saveState();
            showToast(`Cleared ${deletedCount} completed tasks`, 'info');
        };

        window.addSchedule = () => {
            const titleEl = document.getElementById('sched-title');
            const timeEl = document.getElementById('sched-time');
            const durationEl = document.getElementById('sched-duration');
            const typeEl = document.getElementById('sched-type');

            if (!titleEl || !timeEl) return;

            const title = titleEl.value.trim();
            const time = timeEl.value;
            const duration = durationEl ? durationEl.value : '60';
            const type = typeEl ? typeEl.value : 'work';

            if (!title || !time) {
                showToast('Please fill in title and time', 'warning');
                return;
            }

            const newEvent = {
                id: Date.now().toString(),
                title: title,
                time: time,
                duration: duration,
                type: type,
                createdAt: new Date().toISOString()
            };

            state.schedule.push(newEvent);
            titleEl.value = '';
            saveState();
            showToast('Event added to timeline! üìÖ');
        };

        window.deleteSchedule = (id) => {
            state.schedule = state.schedule.filter(s => s.id !== id);
            saveState();
            showToast('Event removed', 'info');
        };

        window.setMood = (mood) => {
            const today = new Date().toISOString().split('T')[0];
            const others = state.moods.filter(m => m.date !== today);
            state.moods = [...others, { date: today, mood }];
            saveState();
            showToast(`Mood updated to ${mood}! ‚ú®`);
        };

        // Init - Apply theme and restore view on load
        applyTheme(state.settings.darkMode);
        switchView(currentView); // Restore last viewed page
    </script>
</body>
</html>